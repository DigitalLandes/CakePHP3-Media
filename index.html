<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>CAKEPHP3-MEDIA par anouarcharif</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>CAKEPHP3-MEDIA</h1>
        <a href="https://github.com/anouarcharif/CakePHP3-Media" class="button"><small>Voir la source sur</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Présentation</h3>

<p>Le principe de ce plugin CakePHP est de vous permettre de créer une gestion d&#39;image poussée pour vos contenu avec le moins de code possible. Le système repose sur un <strong>behaviour</strong> pour gérer l&#39;association des média aux models et un <strong>helper</strong> pour gérer la partie administration des médias.</p>

<p>Ce plugin peut être utilisé en backend comme en front end avec l'utilisation d'une fonction pour gérer les permissions.</p>

<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fonctionnalités</h3>

<p>
	<ul>
		<li>Association belongsTo et hasMany Media pour vos models</li>
		<li>Interface d'upload drag & drop des images basée sur <a href="http://www.plupload.com/">plupload</a></li>
		<li>Intégration de l'uploader d'image dans <a href="http://www.tinymce.com/">tinyMCE</a>, <a href="http://ckeditor.com/">ckeditor</a> et <a href="http://imperavi.com/redactor/">redactor</a></li>
	</ul>
</p>

<h3>
<a id="rather-drive-stick" class="anchor" href="#rather-drive-stick" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>
	La première chose à faire est de copier le plugin Media dans le dossier Plugin de votre application. Pour cela vous pouvez télécharger le .zip ou cloner directement le dépôt
</p>
<pre>
	<code>
		git clone git@github.com:anouarcharif/CakePHP3-Media.git Media
	</code>
</pre>
<p>
Ensuite il vous faut charger le plugin, pour cela dans votre fichier <strong>bootstrap.php</strong> et utiliser le syntaxe suivant:
<pre>
	<code>
	Plugin::load('Media', ['autoload' => true, 'routes' => true]);
	</code>
</pre>
</p>
<p>
	Voila ! le plugin est bien chargé, vous pouvez maintenant créer la table qui va permettre de gérer les différents médias. Pour cela il faut utiliser la requête suivante:
	<pre>
		<code>
			CREATE TABLE  `medias` (
			`id` INT( 11 ) NOT NULL AUTO_INCREMENT ,
			 `ref` VARCHAR( 25 ) NOT NULL ,
			 `ref_id` INT( 11 ) NOT NULL ,
			 `file` VARCHAR( 255 ) DEFAULT NULL ,
			 `position` INT( 11 ) NOT NULL DEFAULT  '0',
			PRIMARY KEY (  `id` ) ,
			KEY  `id` (  `id` ,  `ref` ,  `position` )
			) ENGINE = INNODB DEFAULT CHARSET = latin1;
		</code>
	</pre>
</p>
<hr />
<h3>


<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Permission</h3>

<div class="notif warning">
	Par défaut, le plugin est bloqué pour tout le monde.
</div>
<p>
Pour définir les permission vous pouvez bloquer les actions du plugin depuis votre AppController avec les méthodes par défaut. Pour des permissions plus affinées vous pouvez définir une fonction canUploadMedias($model, $id) dans votre AppController.
Par exemple :
<pre>
	<code>
public function canUploadMedias($table, $id){
	if($table == 'Users' & $id = $this->Session->read('Auth.User.id')){
		return true; // Chaque utilisateur peut modifier les médias de son profil
	}
	return $this->Session->read('Auth.User.role') == 'admin'; // seule l'administrateur peut gérer l'ensemble des médias.
}
	</code>
</pre>
</p>
<h3>
	Le Behaviour
</h3>
<p>
	Pour utiliser le plugin Media vous devez d'abord charger le Behaviour sur vos models. Par exemple si pour mes membres je veux pouvoir avec des images liées :
	
	<pre>
		<code>
//src/Model/Table/MembresTable.php

namespace App\Model\Table;

use Cake\ORM\Table;
use Cake\Utility\Security;
use Cake\Validation\Validator;


class MembersTable extends Table
{
	public function initialize(array $config)
	{
		$this->addBehavior('Media.Media', 
				[
					'refName' => 'Member',
					'path' => '/img/uploads/%y/%m/%f',
					'extensions' => array('jpg', 'png', 'bmp', 'gif'),
					'limit' => 0,
					'max_width' => 0,
					'max_height' => 0,
					'size' => 0
				]
		);
	}
}

		</code>
	</pre>
	Le behaviour prend plusieurs options.
	<ul>
		<li>
			path "img/uploads/%y/%m/%f" - Permet de définir le chemin ou sera stocké l'image par rapport au dossier app/webroot
			<ul>
				<li>
					%y Année d'upload de l'image
				</li>
				<li>
					%m Mois d'upload de l'image
				</li>
				<li>
					%d Jour d'upload de l'image
				</li>
				<li>
					%f Nom du fichier uploadé (sans l'extension et avec un Inflector::slug())
				</li>
				<li>
					%id ID du média
				</li>
				<li>
					%cid ID du média divisé par 100 et arrondit à l'entier suppérieur
				</li>
				<li>
					%mid ID du média divisé par 1000 et arrondit à l'entier suppérieur
				</li>
			</ul>
		</li>
		<li>
			<strong>extensions</strong> ['jpg','png'] - Permet de définir les extensions (minuscules) autorisées pour le plugin
		</li>
		<li>
			<strong>limit</strong> entier - permet de spécifier le nombre maximum de médias qu'un membre peut uploader.
		</li>
		<li>
			<strong>max_width</strong> entier - permet de spécifier la largeur maximum qu'un média peut avoir.
		</li>
		<li>
			<strong>max_height</strong> entier - permet de spécifier la hauteur maximum qu'un média peut avoir.
		</li>
		<li>
			<strong>size</strong> entier - la taille maximum qu'un média peut avoir (0 par défaut et ce n'est pas pris en compte).
		</li>
	</ul>
</p>
<p>
Ce behaviour rajoute 2 liaisons à votre table/model :
<ul>
	<li>
		belongsTo Thumb, afin de récupérer l'image à la une de votre contenu. Ne fonctionne que si votre table à un champs <strong>media_id</strong>
	</li>
	<li>
		hasMany, permet de récupérer toutes les images liées à un contenu.
	</li>
</ul>
</p>
<p>
	Et plusieurs champs lors d'un AppModel::find() si vous ajoutez la liaison avec le model Thumb
	<ul>
		<li>
			Un champs "thumb" contenant l'url de l'image à la une sera ajouté aux champs de votre table/model
		</li>
	</ul>
</p>
<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Helper</h3>

<p>
Maintenant que tout est en place il faut pouvoir ajouter, éditer et supprimer des images. <br />Pour réaliser cela le plugin apporte un helper "Media" qui vous permet de générer une interface drag & drop rapidement. Cet helper fonctionne de 2 façon :
</p>
<p>
	Soit vous pouvez créer une iframe vers le gestionnaire de média :
	<pre>
		<code>
			<?php echo $this->Media->iframe('MODEL',ID); ?>
		</code>
	</pre>
</p>
<p>
	Ou au sain d'un formulaire ($this->Form->create()) vous pouvez créer un champs utilisant tinyMCE, CKEditor et Redactor.js, cette méthode prend les même paramètre que la méthode FormHelper::input.
	<pre>
		<code>
	<?php
	echo $this->Media->tinymce($fieldName, $refName, $refID, $options = array ( ));
	echo $this->Media->ckeditor($fieldName, $refName, $refID, $options = array ( ));
	echo $this->Media->redactor($fieldName, $refName, $refID, $options = array ( ));
	?>
		</code>
	</pre>
</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/anouarcharif/CakePHP3-Media/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/anouarcharif/CakePHP3-Media/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/anouarcharif/CakePHP3-Media"></a> is maintained by <a href="https://github.com/anouarcharif">anouarcharif</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-39368236-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
